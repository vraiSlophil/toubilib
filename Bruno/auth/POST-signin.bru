meta {
  name: /signin
  type: http
  seq: 1
}

post {
  url: {{API_SRC}}/auth/signin
  body: json
  auth: inherit
}

body:json {
  {
    "email": "{{patientEmail}}",
    "password": "P@ssw0rd"
  }
}

script:post-response {
  // persist access/refresh tokens for subsequent folders
  let body = res.getBody();
  bru.setEnvVar("accessToken",body.data.accessToken);
  bru.setEnvVar("refreshToken",body.data.refreshToken);
  if (body.data.profile?.id) {
    bru.setEnvVar("profileId", body.data.profile.id);
  }
}

settings {
  encodeUrl: true
  timeout: 0
}
